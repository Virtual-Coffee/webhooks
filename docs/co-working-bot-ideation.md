# Co-working-room Bot Ideation

## Using Zoom and Slack APIs

### Variables

- **registrant_id** - The ID programmatically generated by Zoom per join request, changes each session
- **slack_id** - The ID generated for a user's Slack profile, remains static
- **slack_call_id** - The ID generated for Slack's call widget per Zoom session, changes each session (stored in DB with **zoom_meeting_id**)
- **zoom_meeting_id** - The ID stored in DB for the life of the Zoom meeting, session-based (stored in DB with **slack_call_id**)

#### **Trigger:** Slack --> A user clicks the **Start a New Session!** or **Join** button in the `#co-working-room` widget

1. Check to see if there's an active **zoom_meeting_id** in the database
    1a. Yes - Retrieve the **zoom_meeting_id** and **slack_call_id** from the database, then proceed to **Step 2**
    1b. No - Create the Zoom meeting
    1c. Call Slack API ([`calls.add`][]) to reflect an active session in the widget
    1d. Store the **zoom_meeting_id** and **slack_call_id** in the database for the duration of the meeting's lifecycle
2. Add a new **registrant_id** via Zoom API - this returns a meeting join URL
3. Redirect the user's browser to the generated meeting join URL to launch the Zoom session

#### **Trigger:** Zoom webhooks --> A user joins the meeting

1. Zoom [`meeting.participant_joined`][] webhook fires
2. Get participant info from the [webhook payload][`meeting.participant_joined`] or the [Get a meeting registrant][] endpoint
3. Call Slack API ([`calls.participants.add`][]) to add the user to the widget

#### **Trigger:** Zoom webhooks --> A user leaves the meeting

1. Zoom [`meeting.participant_left`][] webhook fires
2. Get participant info from the [webhook payload][`meeting.participant_left`] or the [Get a meeting registrant][] endpoint
3. Call Slack API ([`calls.participants.remove`][]) to remove the user from the widget

#### **Trigger:** Zoom webhooks --> The last user leaves the meeting

1. Zoom [`meeting.ended`][] webhook fires
2. Set **zoom_meeting_id** and **slack_call_id** to inactive in the database
3. Call Slack API ([`calls.end`][]) to reflect an ended session in the widget
4. Post a message to `#co-working-room` with the **Start a New Session!** button

### Connecting the APIs

- Add the **slack_id** to a field in Zoom's [Add a meeting registrant][] API
    - Either use the `first_name` field or `custom_questions` array

## Important Links

- [Zoom Developer APIs][Zoom API]
- [Slack Calls API][Slack Calls API]
- [Eddie's Proof of Concept][Eddie's POC]

[Zoom API]: https://developers.zoom.us/docs/api/
[Zoom Endpoints]: https://developers.zoom.us/docs/api/meetings/
[Zoom Webhooks]: https://developers.zoom.us/docs/api/meetings/
[Add a meeting registrant]: https://developers.zoom.us/docs/api/meetings/#tag/meetings/post/meetings/%7BmeetingId%7D/registrants
[Get a meeting registrant]: https://developers.zoom.us/docs/api/meetings/#tag/meetings/get/meetings/%7BmeetingId%7D/registrants/%7BregistrantId%7D
[Delete a meeting registrant]: https://developers.zoom.us/docs/api/meetings/#tag/meetings/delete/meetings/%7BmeetingId%7D/registrants/%7BregistrantId%7D
[`meeting.participant_joined`]: https://developers.zoom.us/docs/api/meetings/events/#tag/meeting/postmeeting.participant_joined
[`meeting.participant_left`]: https://developers.zoom.us/docs/api/meetings/events/#tag/meeting/postmeeting.participant_left
[`meeting.created`]: https://developers.zoom.us/docs/api/meetings/events/#tag/meeting/postmeeting.created
[`meeting.deleted`]: https://developers.zoom.us/docs/api/meetings/events/#tag/meeting/postmeeting.deleted
[`meeting.started`]: https://developers.zoom.us/docs/api/meetings/events/#tag/meeting/postmeeting.started
[`meeting.ended`]: https://developers.zoom.us/docs/api/meetings/events/#tag/meeting/postmeeting.ended
[Slack Calls API]: https://api.slack.com/apis/calls
[`calls.add`]: https://api.slack.com/methods/calls.add
[`calls.end`]: https://api.slack.com/methods/calls.end
[`calls.participants.add`]: https://api.slack.com/methods/calls.participants.add
[`calls.participants.remove`]: https://api.slack.com/methods/calls.participants.remove
[Eddie's POC]: https://github.com/ebanner/vc-co-working-room-app/tree/main
[GitHub discussion]: https://github.com/orgs/Virtual-Coffee/discussions/1312